var Pathfit=function(){"use strict";class t{constructor(t,e){this._str=e,this._pos=0,this.string=t+e,this.offset=t.length}get more(){return this._pos<this._str.length}get position(){return this._pos}get_token(e,s){const r=this._str.substr(this._pos).match(t.regex[e]),a=(r||[""])[0];return this._pos+=a.length,s?null!==r:a}}t.regex={wsp:/^[\x09\x20\x0D\x0A]*/,comma:/^\,/,brace_open:/^\(/,brace_close:/^\)/,flag:/^[01]/,number:/^[\+\-]?(\d*\.\d+|\d+\.?)([eE][\+\-]?\d+)*/,nonnegative:/^(\d*\.\d+|\d+\.?)([eE][\+\-]?\d+)*/};class e extends Error{constructor(t,e,s){super(),this.name="ParseError",this.message=t+"\n",this.message+=(e.string||e)+"\n",this.message+=Array(s).fill("_").join("")+"^"}}class s{constructor(){this.current=[],this.source=""}get_raw(e,s){return new t(e,s)}throw_parse_error(t,s,r){throw new e(t,s,r)}commands(t){const e=t.split(s.command_names),r=e.shift();return/[^\x09\x20\x0D\x0A]+/.test(r)&&this.throw_parse_error("expected nothing before command",r+e[0],0),e}coordinate(t){return{coordinate:this.number(t)}}coordinate_pair_sequence(t,e){const s={};let r=1;for(;r<e;)s["control_"+r]=this.coordinate_pair(t),this.comma_wsp(t),r++;return s.coordinate_pair=this.coordinate_pair(t),s}elliptical_arc(t){const e={rx:this.number(t,!0)};return this.comma_wsp(t),e.ry=this.number(t,!0),this.comma_wsp(t),e.rotation=this.number(t),this.comma_wsp(t),e.large_arc=this.flag(t),this.comma_wsp(t),e.sweep=this.flag(t),this.comma_wsp(t),e.coordinate_pair=this.coordinate_pair(t),e}coordinate_pair(t){const e={x:this.number(t)};return this.comma_wsp(t),e.y=this.number(t),e}coordinate_triple(t){const e={x:this.number(t)};return this.comma_wsp(t),e.y=this.number(t),this.comma_wsp(t),e.z=this.number(t),e}flag(t){const e=t.get_token("flag");return e||this.throw_parse_error("expected flag",t),"1"===e}number(t,e){const s=t.get_token(e?"nonnegative":"number"),r=parseFloat(s);return isNaN(r)&&this.throw_parse_error("expected number",t),r}comma_wsp(t){t.get_token("wsp");const e=t.get_token("comma",!0);return t.get_token("wsp"),e}test_end(t){t.get_token("wsp"),t.more&&this.throw_parse_error("expected nothing after close",t)}collect_arguments(t,e,s){const r=[];let a=!0;for(;a||e.more;)r.length&&(a=this.comma_wsp(e)),(a||e.more)&&r.push(this[t](e,s));return r}group(t){const e=this.commands(t);for(e.length&&!e[0].match(s.movoto_command)&&this.throw_parse_error("expected moveto at start",e.slice(0,2).join(""),0);e.length>1;){const t=e.shift(),s={command:t.toUpperCase()};"Z"!==s.command&&(s.relative=t!==t.toUpperCase());const r=this.get_raw(t,e.shift());switch(r.get_token("wsp"),s.command){case"M":case"L":case"T":s.sequence=this.collect_arguments("coordinate_pair_sequence",r,1);break;case"S":case"Q":s.sequence=this.collect_arguments("coordinate_pair_sequence",r,2);break;case"C":s.sequence=this.collect_arguments("coordinate_pair_sequence",r,3);break;case"H":case"V":s.sequence=this.collect_arguments("coordinate",r);break;case"A":s.sequence=this.collect_arguments("elliptical_arc",r);break;case"Z":this.test_end(r)}this.current.push(s)}return this.current}parse(t){return this.current=[],this.source=t,this.group(t)}}s.command_names=/([mzlhvcsqta])/i,s.movoto_command=/m/i;class r{constructor(t){this.normal_abs=[],this.normal_rel=[],this.transformation=[{command:"scale",sx:1}],Array.isArray(t)&&t.length>0&&(this.transformation=t),this.preprocess()}preprocess(){this.transformation.forEach((function(t){const e=Object.assign({},t),s=Object.assign({},t);switch(t.command){case"matrix":s.e=s.f=0;break;case"translate":s.tx=s.ty=0,e.ty=t.ty||0;break;case"scale":e.sy=s.sy=null!=t.sy?t.sy:t.sx;break;case"rotate":s.cx=s.cy=0,e.cx=t.cx||0,e.cy=t.cy||0}this.normal_abs.push(e),this.normal_rel.push(s)}),this)}static coordinate_pair(t,e){const s=Object.assign({x:0,y:0},e);return t.forEach(t=>{switch(t.command){case"matrix":s.x=t.a*s.x+t.c*s.y+t.e,s.y=t.b*s.x+t.d*s.y+t.f;break;case"translate":s.x+=t.tx,s.y+=t.ty;break;case"scale":s.x*=t.sx,s.y*=t.sy;break;case"rotate":s.x-=t.cx,s.y-=t.cy;const e=Math.sqrt(s.x*s.x+s.y*s.y),r=180*Math.atan2(s.y,s.x)/Math.PI+t.angle;s.x=e*Math.cos(r*Math.PI/180),s.y=e*Math.sin(r*Math.PI/180),s.x+=t.cx,s.y+=t.cy;break;case"skewX":s.x+=Math.tan(t.angle/180*Math.PI)*s.y;break;case"skewY":s.y+=Math.tan(t.angle/180*Math.PI)*s.x}}),s}static arc_matrix(t,e){const s=Math.cos(e.rotation/180*Math.PI),r=Math.sin(e.rotation/180*Math.PI),a=[e.rx*(t.a*s+t.c*r),e.rx*(t.b*s+t.d*r),e.ry*(t.c*s-t.a*r),e.ry*(t.d*s-t.b*r)],i=a[0]*a[0]+a[2]*a[2],n=2*(a[0]*a[1]+a[2]*a[3]),o=a[1]*a[1]+a[3]*a[3],c=Math.sqrt((i-o)*(i-o)+n*n);return{rx:Math.sqrt(.5*(i+o+c)),ry:Math.sqrt(.5*Math.max(0,i+o-c)),rotation:Math.abs((i-o)/n)<1e-6?90:90*Math.atan2(n,i-o)/Math.PI}}static elliptical_arc(t,e){return t.concat([]).reverse().forEach(t=>{let s;switch(t.command){case"scale":s=r.coordinate_pair(t,{x:e.rx,y:e.ry}),e.rx=Math.abs(s.x),e.ry=Math.abs(s.y),t.sx*t.sy<0&&(e.sweep=!e.sweep);break;case"rotate":e.rotation=(e.rotation+t.angle)%180;break;case"skewX":case"skewY":t={command:"matrix",a:1,b:"skewY"===t.command?Math.tan(t.angle/180*Math.PI):0,c:"skewX"===t.command?Math.tan(t.angle/180*Math.PI):0,d:1,e:0,f:0};case"matrix":s=r.arc_matrix(t,e),e.rx=s.rx,e.ry=s.ry,e.rotation=s.rotation,t.a*t.d-t.b*t.c<0&&(e.sweep=!e.sweep)}}),e.coordinate_pair=r.coordinate_pair(t,e.coordinate_pair),e}nest_transforms(t,e,s){const a=Object.assign({},e);return("arc"===t?r.elliptical_arc:r.coordinate_pair)(s?this.normal_rel:this.normal_abs,a)}argument_obj(t,e,s){let r={};switch(t){case"A":r=this.nest_transforms("arc",s,e);break;case"C":r.control_2=this.nest_transforms("pair",s.control_2,e);case"S":case"Q":r.control_1=this.nest_transforms("pair",s.control_1,e);default:r.coordinate_pair=this.nest_transforms("pair",s.coordinate_pair,e)}return r}transform(t){return t.map((t,e)=>{let s=t.command;if("Z"===s)return{command:s};let r=!0,a=!0,i=t.sequence.map((i,n)=>{let o=s,c=t.relative;switch(s){case"H":i={coordinate_pair:{x:i.coordinate,y:0}},o="L";break;case"V":i={coordinate_pair:{x:0,y:i.coordinate}},o="L";break;case"M":0===e&&0===n&&(c=!1)}const h=this.argument_obj(o,c,i);return r=r&&0===h.coordinate_pair.y,a=a&&0===h.coordinate_pair.x,h},this);return"L"===s&&(r?(s="H",i=i.map(t=>({coordinate:t.coordinate_pair.x}))):a&&(s="V",i=i.map(t=>({coordinate:t.coordinate_pair.y})))),{command:s,relative:t.relative,sequence:i}},this)}}class a{constructor(t,e,s,r){this.set_viewport(t,e,s),this.set_preserveAspectRatio(r)}static get error(){return new Error("Cannot determine the size of the drawing.")}static parse_length(t){const e="number"==typeof t?null:t.match(a.regex)[1],s=parseFloat(t);if(0===s||e&&"px"!==e)throw a.error;return s}set_viewport(t,e,s){if(s){if([this.x,this.y,this.width,this.height]=s.split(/[,\s]+/).map(t=>parseFloat(t)),0===this.width||0===this.height)throw a.error}else{if(!t||!e)throw a.error;this.x=0,this.y=0,this.width=a.parse_length(t),this.height=a.parse_length(e)}}set_preserveAspectRatio(t=""){[this.align="xMidYMid",this.meetOrSlice="meet"]=t.split(/\s/)}transform(t,e){const s=a.parse_length(t),r=a.parse_length(e);let i=s/this.width,n=r/this.height;"none"!==this.align&&(i=n="slice"===this.meetOrSlice?Math.max(i,n):Math.min(i,n));let o=-this.x*i,c=-this.y*n;this.align.includes("xMid")&&(o+=(s-this.width*i)/2),this.align.includes("xMax")&&(o+=s-this.width*i),this.align.includes("YMid")&&(c+=(r-this.height*n)/2),this.align.includes("YMax")&&(c+=r-this.height*n);const h=[];return 0===o&&0===c||h.push({command:"translate",tx:o,ty:c}),1===i&&1===n||h.push({command:"scale",sx:i,sy:n}),h}}a.regex=/^(?:\d*\.\d+|\d+\.?)(?:[eE][\+\-]?\d+)*(.+)?/;class i{constructor(t){this.options=Object.assign({precision:6},t)}flag(t){return t?1:0}number(t){return-Math.log(Math.abs(t))/Math.LN10>this.options.precision+3?0:+t.toPrecision(this.options.precision)}pair(t,e,s){return this.number(t[e])+i.pair_wsp+this.number(t[s])}argument(t,e){const s=[];switch(t){case"C":s.unshift(this.pair(e.control_2,"x","y"));case"S":case"Q":s.unshift(this.pair(e.control_1,"x","y"));case"M":case"L":case"T":s.push(this.pair(e.coordinate_pair,"x","y"));break;case"H":case"V":s.push(this.number(e.coordinate));break;case"A":s.push(this.pair(e,"rx","ry"),this.number(e.rotation),this.flag(e.large_arc),this.flag(e.sweep),this.pair(e.coordinate_pair,"x","y"))}return s.join(i.arg_wsp)}command(t,e){return t+=t?i.wsp:"","Z"===e.command?t+="z":(t+=(e.relative?e.command.toLowerCase():e.command)+i.wsp,t+=e.sequence.map(this.argument.bind(this,e.command)).join(i.arg_wsp)),t}format(t){return t.reduce(this.command.bind(this),"")}}i.wsp="",i.pair_wsp=" ",i.arg_wsp=" ";return class{constructor(t,e,s){const{width:r,height:n,viewBox:o,preserveAspectRatio:c}=t;this.scale=new a(r,n,o,c),e&&(this.path=e),this.formatter=new i(Object.assign({precision:6},s))}set_fit(t){this.scale.set_preserveAspectRatio(t)}set path(t){this._ast=(new s).parse(t)}get path(){return this.formatter(this._ast)}scale_to(t,e){const s=this.scale.transform(t,e),a=new r(s).transform(this._ast);return this.formatter.format(a)}}}();
