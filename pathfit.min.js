var Pathfit=function(){"use strict";class t{constructor(t,e){this._str=e,this._pos=0,this.string=t+e,this.offset=t.length}get more(){return this._pos<this._str.length}get position(){return this._pos}get_token(e,r){const s=this._str.substr(this._pos).match(t.regex[e]),a=(s||[""])[0];return this._pos+=a.length,r?null!==s:a}}t.regex={wsp:/^[\x09\x20\x0D\x0A]*/,comma:/^\,/,brace_open:/^\(/,brace_close:/^\)/,flag:/^[01]/,number:/^[\+\-]?(\d*\.\d+|\d+\.?)([eE][\+\-]?\d+)*/,nonnegative:/^(\d*\.\d+|\d+\.?)([eE][\+\-]?\d+)*/};var e=t;class r extends Error{constructor(t,e,r){super(),this.name="ParseError",this.message=t+"\n",this.message+=(e.string||e)+"\n",this.message+=Array(r).fill("_").join("")+"^"}}var s=class{constructor(){this.current=[],this.source=""}get_raw(t,r){return new e(t,r)}throw_parse_error(t,e,s){throw new r(t,e,s)}commands(t){const e=t.split(this.command_names),r=e.shift();return/[^\x09\x20\x0D\x0A]+/.test(r)&&this.throw_parse_error("expected nothing before command",r+e[0],0),e}coordinate(t){return{coordinate:this.number(t)}}coordinate_pair_sequence(t,e){const r={};let s=1;for(;s<e;)r["control_"+s]=this.coordinate_pair(t),this.comma_wsp(t),s++;return r.coordinate_pair=this.coordinate_pair(t),r}elliptical_arc(t){const e={rx:this.number(t,!0)};return this.comma_wsp(t),e.ry=this.number(t,!0),this.comma_wsp(t),e.rotation=this.number(t),this.comma_wsp(t),e.large_arc=this.flag(t),this.comma_wsp(t),e.sweep=this.flag(t),this.comma_wsp(t),e.coordinate_pair=this.coordinate_pair(t),e}coordinate_pair(t){const e={x:this.number(t)};return this.comma_wsp(t),e.y=this.number(t),e}coordinate_triple(t){const e={x:this.number(t)};return this.comma_wsp(t),e.y=this.number(t),this.comma_wsp(t),e.z=this.number(t),e}flag(t){const e=t.get_token("flag");return e||this.throw_parse_error("expected flag",t),"1"===e}number(t,e){const r=t.get_token(e?"nonnegative":"number"),s=parseFloat(r);return isNaN(s)&&this.throw_parse_error("expected number",t),s}comma_wsp(t){t.get_token("wsp");const e=t.get_token("comma",!0);return t.get_token("wsp"),e}test_end(t){t.get_token("wsp"),t.more&&this.throw_parse_error("expected nothing after close",t)}parse(t){return this.current=[],this.source=t,this.group(t)}};const a=/([mzlhvcsqta])/i,n=/m/i;var o=class extends s{get command_names(){return a}collect_arguments(t,e,r){const s=[];let a=!0;for(;a||e.more;)s.length&&(a=this.comma_wsp(e)),(a||e.more)&&s.push(this[t](e,r));return s}group(t){const e=this.commands(t);for(e.length&&!e[0].match(n)&&this.throw_parse_error("expected moveto at start",e.slice(0,2).join(""),0);e.length>1;){const t=e.shift(),r={command:t.toUpperCase()};"Z"!==r.command&&(r.relative=t!==t.toUpperCase());const s=this.get_raw(t,e.shift());switch(s.get_token("wsp"),r.command){case"M":case"L":case"T":r.sequence=this.collect_arguments("coordinate_pair_sequence",s,1);break;case"S":case"Q":r.sequence=this.collect_arguments("coordinate_pair_sequence",s,2);break;case"C":r.sequence=this.collect_arguments("coordinate_pair_sequence",s,3);break;case"H":case"V":r.sequence=this.collect_arguments("coordinate",s);break;case"A":r.sequence=this.collect_arguments("elliptical_arc",s);break;case"Z":this.test_end(s)}this.current.push(r)}return this.current}parse(t){return this.current=[],this.source=t,this.group(t)}};const i=/(matrix|translate|scale|rotate|skewX|skewY)/i,c={matrix:{args:["a","b","c","d","e","f"],required:6},translate:{args:["tx","ty"],required:1},scale:{args:["sx","sy"],required:1},rotate:{args:["angle","cx","cy"],required:1},skewX:{args:["angle"],required:1},skewY:{args:["angle"],required:1}};var h=class extends s{get command_names(){return i}collect_arguments(t,e,r){t.get_token("wsp"),t.get_token("brace_open",!0)||this.throw_parse_error("expected opening brace",t),t.get_token("wsp");const s={};e.some(e=>{s[e]=this.number(t);const r=this.comma_wsp(t);return t.get_token("brace_close",!0)&&!r})||this.throw_parse_error("expected closing brace",t);const a=Object.keys(s).length;return a!==r&&a!==e.length&&this.throw_parse_error("wrong number of arguments",t),this.test_end(t),s}group(t){const e=this.commands(t,i);for(;e.length>1;){const t=e.shift(),r=this.get_raw(t,e.shift()),{args:s,required:a}=c[t],n=this.collect_arguments(r,s,a);n.command=t,this.current.push(n)}return this.current}parse(t){Array.isArray(t)&&(t=t.join(" ")),super.parse(t)}};class m{constructor(t){this.normal_abs=[],this.normal_rel=[],this.transformation=[{command:"scale",sx:1}],Array.isArray(t)&&t.length>0&&(this.transformation=t),this.preprocess()}preprocess(){this.transformation.forEach((function(t){const e={...t},r={...t};switch(t.command){case"matrix":r.e=r.f=0;break;case"translate":r.tx=r.ty=0,e.ty=t.ty||0;break;case"scale":e.sy=r.sy=null!=t.sy?t.sy:t.sx;break;case"rotate":r.cx=r.cy=0,e.cx=t.cx||0,e.cy=t.cy||0}this.normal_abs.push(e),this.normal_rel.push(r)}),this)}static round(t){return Math.abs(Math.round(t)-t)<1e-10?Math.round(t)+0:t}static coordinate_pair(t,e){const r=Object.assign({x:0,y:0},e);return t.concat([]).reverse().forEach(t=>{switch(t.command){case"matrix":const e=r.x,s=r.y;r.x=t.a*e+t.c*s+t.e,r.y=t.b*e+t.d*s+t.f;break;case"translate":r.x+=t.tx,r.y+=t.ty;break;case"scale":r.x*=t.sx,r.y*=t.sy;break;case"rotate":r.x-=t.cx,r.y-=t.cy;const a=Math.sqrt(r.x*r.x+r.y*r.y),n=180*Math.atan2(r.y,r.x)/Math.PI+t.angle;r.x=a*Math.cos(n*Math.PI/180),r.y=a*Math.sin(n*Math.PI/180),r.x+=t.cx,r.y+=t.cy;break;case"skewX":r.x+=Math.tan(t.angle/180*Math.PI)*r.y;break;case"skewY":r.y+=Math.tan(t.angle/180*Math.PI)*r.x}}),r.x=m.round(r.x),r.y=m.round(r.y),r}static arc_matrix(t,e){const r=Math.cos(e.rotation/180*Math.PI),s=Math.sin(e.rotation/180*Math.PI),a=[e.rx*(t.a*r+t.c*s),e.rx*(t.b*r+t.d*s),e.ry*(t.c*r-t.a*s),e.ry*(t.d*r-t.b*s)],n=a[0]*a[0]+a[2]*a[2],o=2*(a[0]*a[1]+a[2]*a[3]),i=a[1]*a[1]+a[3]*a[3],c=Math.sqrt((n-i)*(n-i)+o*o);return{rx:m.round(Math.sqrt(.5*(n+i+c))),ry:m.round(Math.sqrt(.5*Math.max(0,n+i-c))),rotation:m.round(90*Math.atan2(o,n-i)/Math.PI)}}static elliptical_arc(t,e){return t.concat([]).reverse().forEach(t=>{let r;switch(t.command){case"translate":r=[{command:"rotate",angle:e.rotation,cx:0,cy:0}];break;case"rotate":r=[{command:"rotate",angle:t.angle+e.rotation,cx:0,cy:0}];break;case"matrix":r=[{...t,e:0,f:0},{command:"rotate",angle:e.rotation,cx:0,cy:0}];break;default:r=[t,{command:"rotate",angle:e.rotation,cx:0,cy:0}]}const s=m.coordinate_pair(r,{x:e.rx,y:0}),a=m.coordinate_pair(r,{x:0,y:e.ry}),n={command:"matrix",a:s.x/e.rx,b:s.y/e.rx,c:a.x/e.ry,d:a.y/e.ry,e:0,f:0};e.rotation=0,({rx:e.rx,ry:e.ry,rotation:e.rotation}=m.arc_matrix(n,{...e})),n.a*n.d-n.b*n.c<0&&(e.sweep=!e.sweep)}),e.coordinate_pair=m.coordinate_pair(t,e.coordinate_pair),e}nest_transforms(t,e,r){const s={...e};return("arc"===t?m.elliptical_arc:m.coordinate_pair)(r?this.normal_rel:this.normal_abs,s)}argument_obj(t,e,r){let s={};switch(t){case"A":s=this.nest_transforms("arc",r,e);break;case"C":s.control_2=this.nest_transforms("pair",r.control_2,e);case"S":case"Q":s.control_1=this.nest_transforms("pair",r.control_1,e);default:s.coordinate_pair=this.nest_transforms("pair",r.coordinate_pair,e)}return s}transform(t){let e,r;return t.map((t,s)=>{let a=t.command;if("Z"===a)return{command:a};let n=t.sequence.map((n,o)=>{let i=a,c=t.relative;switch(a){case"H":n={coordinate_pair:{x:n.coordinate,y:c?0:r}},i="L";break;case"V":n={coordinate_pair:{x:c?0:e,y:n.coordinate}},i="L";break;case"M":0===s&&0===o&&(c=!1)}const h=this.argument_obj(i,c,n);return c?(e+=n.coordinate_pair.x,r+=n.coordinate_pair.y):(e=n.coordinate_pair.x,r=n.coordinate_pair.y),h},this);return"H"!==a&&"V"!==a||(a="L"),{command:a,relative:t.relative,sequence:n}},this)}}var p=m;class _{constructor(t,e,r,s){this.set_viewport(t,e,r),this.set_preserveAspectRatio(s)}static get error(){return new Error("Cannot determine the size of the drawing.")}static parse_length(t){const e="number"==typeof t?null:t.match(_.regex)[1],r=parseFloat(t);if(r<=0||e&&"px"!==e)throw _.error;return r}set_viewport(t,e,r){if(r){if([this.x,this.y,this.width,this.height]=r.split(/[,\s]+/).map(t=>parseFloat(t)),this.width<=0||this.height<=0)throw _.error}else{if(!t||!e)throw _.error;this.x=0,this.y=0,this.width=_.parse_length(t),this.height=_.parse_length(e)}}set_preserveAspectRatio(t="xMidYMid meet"){[this.align,this.meetOrSlice]=t.split(/\s/)}transform(t,e){const r=_.parse_length(t),s=_.parse_length(e);let a=r/this.width,n=s/this.height;"none"!==this.align&&(a=n="slice"===this.meetOrSlice?Math.max(a,n):Math.min(a,n));let o=-this.x*a+0,i=-this.y*n+0;this.align.includes("xMid")&&(o+=(r-this.width*a)/2),this.align.includes("xMax")&&(o+=r-this.width*a),this.align.includes("YMid")&&(i+=(s-this.height*n)/2),this.align.includes("YMax")&&(i+=s-this.height*n);const c=[];return 0===o&&0===i||c.push({command:"translate",tx:o,ty:i}),1===a&&1===n||c.push({command:"scale",sx:a,sy:n}),c}}_.regex=/^(?:\d*\.\d+|\d+\.?)(?:[eE][\+\-]?\d+)*(.+)?/;var l=_;class u{constructor(t){this.options=Object.assign({precision:6},t)}flag(t){return t?1:0}number(t){return-Math.log(Math.abs(t))/Math.LN10>this.options.precision+3?0:+t.toPrecision(this.options.precision)}pair(t,e,r){return this.number(t[e])+u.pair_wsp+this.number(t[r])}argument(t,e){const r=[];switch(t){case"C":r.unshift(this.pair(e.control_2,"x","y"));case"S":case"Q":r.unshift(this.pair(e.control_1,"x","y"));case"M":case"L":case"T":r.push(this.pair(e.coordinate_pair,"x","y"));break;case"H":case"V":r.push(this.number(e.coordinate));break;case"A":r.push(this.pair(e,"rx","ry"),this.number(e.rotation),this.flag(e.large_arc),this.flag(e.sweep),this.pair(e.coordinate_pair,"x","y"))}return r.join(u.arg_wsp)}command(t,e){return t+=t?u.wsp:"","Z"===e.command?t+="z":(t+=(e.relative?e.command.toLowerCase():e.command)+u.wsp,t+=e.sequence.map(this.argument.bind(this,e.command)).join(u.arg_wsp)),t}format(t){return t.reduce(this.command.bind(this),"")}}u.wsp="",u.pair_wsp=" ",u.arg_wsp=" ";var d=u;return class{constructor(t,e,r,s){t&&this.set_viewbox(t),e&&this.set_path(e,r),this.formatter=new d(Object.assign({precision:6},s))}set_viewbox(t){const{width:e,height:r,viewBox:s,preserveAspectRatio:a}=t;this.scale=new l(e,r,s,a)}set_fit(t){if(!this.scale)throw new Error("no reference viewBox is set");this.scale.set_preserveAspectRatio(t)}set_path(t,e){if(this._ast=(new o).parse(t),e){const t=(new h).parse(e);this._ast=this._transform_ast(t)}return this.formatter.format(this._ast)}_transform_ast(t){if(!this._ast)throw new Error("no path is set");return new p(t).transform(this._ast)}transform(t){const e=(new h).parse(t),r=this._transform_ast(e);return this.formatter.format(r)}scale_to(t,e){if(!this.scale)throw new Error("no reference viewBox is set");const r=this.scale.transform(t,e),s=this._transform_ast(r);return this.formatter.format(s)}}}();
